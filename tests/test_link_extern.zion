module _
# test: pass
# expect: allocating entry for Will: 123
# expect: freeing entry Will: 123

# TODO: clean this up - add in some sort of ability to autoexpand env vars, or compilation params
# link in "build-Darwin/tests/test_link_extern_entry.o"
link in "/tmp/test_link_extern_entry.o"

link def make_entry(name *char_t, number int_t) *EntryImpl
link def free_entry(entry *EntryImpl) void
link def get_name(entry *EntryImpl) *char_t
link def get_number(entry *EntryImpl) int_t

type EntryImpl struct
type Entry has
	var entry *EntryImpl

[global]
def __finalize__(entry Entry)
	free_entry(entry.entry)

def get_name(entry Entry) str
	return __box__(get_name(entry.entry))

def main()
	var entry Entry? = Entry(make_entry("Will"r, 123r))
	if entry != null
		print(get_name(entry))
	entry = null
	runtime.gc()
